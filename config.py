import json
import os
import discord
import aiohttp
import io

DATA_FILE = "data.json"

# =========================================
# ЁЯУЭ р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (MESSAGES)
# =========================================
MESSAGES = {
    # ... (р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Фр╕┤р╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф р╕лр╣Йр╕▓р╕бр╕ер╕Ъ) ...
    
    # [NEW] Restock Messages
    "res_log_title": "ЁЯФД р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Бр╕▓р╕гр╣Ар╕Хр╕┤р╕бр╕Вр╕нр╕З",
    "res_log_desc": "р╣Бр╕нр╕Фр╕бр╕┤р╕Щ {admin} р╣Др╕Фр╣Йр╕Чр╕│р╕Бр╕▓р╕гр╣Ар╕Хр╕┤р╕бр╕Вр╕нр╕Зр╕гр╕▓р╕Зр╕зр╕▒р╕ер╣Ар╕Вр╣Йр╕▓р╕Хр╕╣р╣Йр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з!",
    "res_log_items": "ЁЯУж **р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Чр╕╡р╣Ир╣Ар╕Хр╕┤р╕б:**",
    
    # ... (р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕нр╕╖р╣Ир╕Щр╣Ж р╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕б) ...
    "desc_addadmin": "р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Бр╕нр╕Фр╕бр╕┤р╕Щр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕лр╕гр╕╖р╕нр╕Ър╕Чр╕Ър╕▓р╕Ч",
    "desc_removeadmin": "р╕ер╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Бр╕нр╕Фр╕бр╕┤р╕Щ",
    "desc_addsupport": "р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕┤р╕Чр╕Шр╕┤р╣М Support (р╕Чр╕╡р╕бр╕Зр╕▓р╕Щ)",
    "desc_removesupport": "р╕ер╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣М Support",
    "desc_lockdown": "р╕Бр╕│р╕лр╕Щр╕Фр╣Ар╕зр╕ер╕▓р╕ер╣Зр╕нр╕Др╕Кр╣Ир╕нр╕З (р╕зр╕┤р╕Щр╕▓р╕Чр╕╡)",
    "desc_resetdata": "р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Щр╕▒р╕Ъ ID р╕Хр╣Ир╕▓р╕Зр╣Ж",
    "desc_addpoint": "р╣Ар╕Юр╕┤р╣Ир╕б Point р╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й",
    "desc_removepoint": "р╕ер╕Ъ Point р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й",
    "desc_auction": "р╣Ар╕гр╕┤р╣Ир╕бр╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╕бр╕╣р╕ер╕кр╕┤р╕Щр╕Др╣Йр╕▓",
    "desc_ticketf": "р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕гр╕░р╕Ър╕Ъ Ticket р╣Гр╕Щ Forum",
    "desc_gamble": "р╕кр╕гр╣Йр╕▓р╕Зр╕лр╣Йр╕нр╕Зр╕кр╕╕р╣Ир╕бр╕Бр╕▓р╕Кр╕▓/р╣Ар╕Хр╕┤р╕бр╣Ар╕Зр╕┤р╕Щ",
    "desc_restock": "р╣Ар╕Хр╕┤р╕бр╕Вр╕нр╕З/р╣Бр╕Бр╣Йр╣Др╕Вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕╣р╣Йр╕Бр╕▓р╕Кр╕▓ (Restock)",

    "no_permission": "ЁЯЪл р╕Др╕╕р╕Ур╣Др╕бр╣Ир╕бр╕╡р╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Гр╕Кр╣Йр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Щр╕╡р╣Й",
    "cmd_success": "тЬЕ р╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в",
    "loading": "тП│ р╕Бр╕│р╕ер╕▒р╕Зр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е...",
    "processing": "тЪЩя╕П р╕Бр╕│р╕ер╕▒р╕Зр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г...",
    "msg_error_num": "тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Хр╕▒р╕зр╣Ар╕ер╕Вр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ",
    
    "pt_add_success": "тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б {amount} р╣Бр╕Хр╣Йр╕б р╣Гр╕лр╣Йр╕Бр╕▒р╕Ъ {user} р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в",
    "pt_remove_success": "тЬЕ р╕ер╕Ъ {amount} р╣Бр╕Хр╣Йр╕б р╕нр╕нр╕Бр╕Ир╕▓р╕Б {user} р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в",
    "pt_current": "р╣Бр╕Хр╣Йр╕бр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ: {points}",
    "insufficient_points": "тЭМ р╣Бр╕Хр╣Йр╕бр╕Вр╕нр╕Зр╕Др╕╕р╕Ур╣Др╕бр╣Ир╕Юр╕н (р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г {cost} р╣Бр╕Хр╣Йр╕б)",
    "point_balance": "ЁЯТ░ р╣Бр╕Хр╣Йр╕бр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н: {points}",

    "sys_add_admin": "тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б {target} р╣Ар╕Ыр╣Зр╕Щр╣Бр╕нр╕Фр╕бр╕┤р╕Щ",
    "sys_already_admin": "тЪая╕П {target} р╣Ар╕Ыр╣Зр╕Щр╣Бр╕нр╕Фр╕бр╕┤р╕Щр╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з",
    "sys_remove_admin": "тЬЕ р╕ер╕Ъ {target} р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╣Бр╕нр╕Фр╕бр╕┤р╕Щ",
    "sys_not_admin": "тЪая╕П {target} р╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Бр╕нр╕Фр╕бр╕┤р╕Щ",
    "sys_add_support": "тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б {target} р╣Ар╕Ыр╣Зр╕Щ Support",
    "sys_already_support": "тЪая╕П {target} р╣Ар╕Ыр╣Зр╕Щ Support р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з",
    "sys_remove_support": "тЬЕ р╕ер╕Ъ {target} р╕нр╕нр╕Бр╕Ир╕▓р╕Б Support",
    "sys_not_support": "тЪая╕П {target} р╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Ар╕Ыр╣Зр╕Щ Support",
    "sys_lockdown_set": "тЬЕ р╕Хр╕▒р╣Йр╕Зр╣Ар╕зр╕ер╕▓ Lockdown: {seconds} р╕зр╕┤р╕Щр╕▓р╕Чр╕╡",
    "sys_reset_done": "тЬЕ р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в",

    "gam_setup_1_msg": "ЁЯЫая╕П **Setup 1/5**\nр╣Ар╕ер╕╖р╕нр╕Бр╕Кр╣Ир╕нр╕Зр╕Чр╕╡р╣Ир╕Ир╕░р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б р╣Бр╕ер╕░р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕Хр╣Йр╕Щ",
    "gam_setup_1_btn": "р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е (р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б/р╕гр╕╣р╕Ы)",
    "gam_modal_1_title": "р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ",
    "gam_lbl_content": "р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕Вр╕╡р╕вр╕Щ",
    "gam_lbl_img1": "р╕ер╕┤р╣Йр╕Зр╕Др╣Мр╕гр╕╣р╕Ыр╕Ыр╕Б (Embed)",
    "gam_lbl_img2": "р╕ер╕┤р╣Йр╕Зр╕Др╣Мр╕гр╕╣р╕Ыр╕Хр╕нр╕Щр╕кр╕╕р╣Ир╕б (Gacha Show)",
    "gam_lbl_btn_txt": "р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ыр╕╕р╣Ир╕бр╕кр╕╕р╣Ир╕б",
    "gam_lbl_cost": "р╕гр╕▓р╕Др╕▓р╕Хр╣Ир╕нр╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕б 1 р╕Др╕гр╕▒р╣Йр╕З",
    "gam_ph_cost": "р╣Гр╕кр╣Ир╕Хр╕▒р╕зр╣Ар╕ер╕Вр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ",
    "gam_setup_2_msg": "ЁЯЫая╕П **Setup 2/5**\nр╣Ар╕ер╕╖р╕нр╕Бр╕Кр╣Ир╕нр╕З Log р╣Бр╕ер╕░р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕гр╕▓р╕Зр╕зр╕▒р╕е (р╕кр╕╣р╕Зр╕кр╕╕р╕Ф 15 р╕Кр╕┤р╣Йр╕Щ)\n*р╣Вр╕нр╕Бр╕▓р╕кр╣Гр╕кр╣Ир╣Ар╕Ыр╣Зр╕Щр╕Хр╕▒р╕зр╣Ар╕ер╕Вр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╣Др╕Фр╣Йр╣Ар╕ер╕в р╣Др╕бр╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щр╕Хр╣Йр╕нр╕Зр╕гр╕зр╕бр╣Др╕Фр╣Й 100*",
    "gam_setup_2_next": "р╕Цр╕▒р╕Фр╣Др╕Ы тЮбя╕П",
    "gam_btn_chance_1": "р╣Вр╕нр╕Бр╕▓р╕к (1-5)",
    "gam_btn_chance_2": "р╣Вр╕нр╕Бр╕▓р╕к (6-10)",
    "gam_btn_chance_3": "р╣Вр╕нр╕Бр╕▓р╕к (11-15)",
    "gam_btn_img_1": "р╕гр╕╣р╕Ыр╕гр╕▓р╕Зр╕зр╕▒р╕е (1-5)",
    "gam_btn_img_2": "р╕гр╕╣р╕Ыр╕гр╕▓р╕Зр╕зр╕▒р╕е (6-10)",
    "gam_btn_img_3": "р╕гр╕╣р╕Ыр╕гр╕▓р╕Зр╕зр╕▒р╕е (11-15)",
    "gam_modal_chance_title": "р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Вр╕нр╕Бр╕▓р╕к (Part {part})",
    "gam_modal_img_title": "р╕ер╕┤р╣Йр╕Зр╕Др╣Мр╕гр╕╣р╕Ыр╕гр╕▓р╕Зр╕зр╕▒р╕е (Part {part})",
    "gam_lbl_c_prefix": "р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕▓р╕Зр╕зр╕▒р╕ер╕Чр╕╡р╣И {n}",
    "gam_lbl_i_prefix": "р╕гр╕╣р╕Ыр╕гр╕▓р╕Зр╕зр╕▒р╕ер╕Чр╕╡р╣И {n}",
    "gam_setup_3_msg": "ЁЯЫая╕П **Setup 3/5**\nр╣Ар╕ер╕╖р╕нр╕Бр╣Вр╕лр╕бр╕Фр╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕б р╣Бр╕ер╕░р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ",
    "gam_setup_3_select_mode": "р╣Ар╕ер╕╖р╕нр╕Бр╣Вр╕лр╕бр╕Фр╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕б",
    "gam_mode_unlimited": "ЁЯФД р╕кр╕╕р╣Ир╕бр╕Лр╣Йр╕│р╣Др╕Фр╣Йр╣Ар╕гр╕╖р╣Ир╕нр╕вр╣Ж (Unlimited)",
    "gam_mode_limited": "тЫФ р╕кр╕╕р╣Ир╕бр╣Бр╕ер╣Йр╕зр╕лр╕бр╕Фр╣Др╕Ыр╣Ар╕ер╕в (Limited)",
    "gam_err_select_mode": "тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╣Вр╕лр╕бр╕Фр╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕бр╕Бр╣Ир╕нр╕Щ",
    "gam_err_out_of_stock": "тЭМ р╕гр╕▓р╕Зр╕зр╕▒р╕ер╕Щр╕╡р╣Йр╕нр╕нр╕Бр╣Др╕Ыр╣Бр╕ер╣Йр╕з! (р╕гр╕░р╕Ър╕Ър╕Др╕╖р╕Щр╣Бр╕Хр╣Йр╕бр╣Гр╕лр╣Йр╕Др╕╕р╕У)",
    "gam_err_sold_out": "тЭМ р╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕лр╕бр╕Фр╣Ар╕Бр╕ер╕╡р╣Йр╕вр╕Зр╣Бр╕ер╣Йр╕з!",
    "gam_setup_3_btn": "р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Бр╕▓р╕гр╣Вр╕нр╕Щ",
    "gam_modal_pay_title": "р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ",
    "gam_lbl_tm_txt": "р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б TrueMoney",
    "gam_lbl_pp_txt": "р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б PromptPay",
    "gam_lbl_phone": "р╣Ар╕Ър╕нр╕гр╣Мр╕зр╕нр╣Ар╕ер╕Ч (р╕гр╕▒р╕Ър╕Лр╕нр╕З)",
    "gam_lbl_qr": "р╕ер╕┤р╣Йр╕Зр╕Др╣Мр╕гр╕╣р╕Ы QR Code",
    "gam_setup_4_msg": "ЁЯЫая╕П **Setup 4/5**\nр╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Чр╕▒р╣Йр╕З 15 р╕Кр╕┤р╣Йр╕Щ (р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Бр╕кр╕Фр╕Зр╣Гр╕Щр╕Ыр╕╕р╣Ир╕бр╣Ар╕Кр╣Зр╕Др╕кр╕┤р╕Щр╕Др╣Йр╕▓)",
    "gam_btn_name_1": "р╕Кр╕╖р╣Ир╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓ (1-5)",
    "gam_btn_name_2": "р╕Кр╕╖р╣Ир╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓ (6-10)",
    "gam_btn_name_3": "р╕Кр╕╖р╣Ир╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓ (11-15)",
    "gam_modal_name_title": "р╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓ (Part {part})",
    "gam_lbl_n_prefix": "р╕Кр╕╖р╣Ир╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Чр╕╡р╣И {n}",
    "gam_ph_name": "р╣Ар╕Кр╣Ир╕Щ iPhone 15, р╕Чр╕нр╕Зр╕Др╕│ 1 р╕Ър╕▓р╕Ч",
    "gam_setup_5_msg": "ЁЯЫая╕П **Setup 5/5 (р╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в)**\nр╣Ар╕ер╕╖р╕нр╕Бр╕Кр╣Ир╕нр╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ъ **р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕кр╕ер╕┤р╕Ы** (р╣Бр╕нр╕Фр╕бр╕┤р╕Щр╣Ар╕лр╣Зр╕Щр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ)",
    "gam_setup_finish": "тЬЕ р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╕кр╕гр╣Йр╕▓р╕Зр╕лр╣Йр╕нр╕Зр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕бр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в",
    "res_setup_msg": "ЁЯЫая╕П **Restock Mode**\nр╕Бр╕│р╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕Вр╕Хр╕╣р╣Й: {url}\nр╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╕▓р╕Зр╕зр╕▒р╕ер╣Гр╕лр╕бр╣И 15 р╕Кр╕┤р╣Йр╕Щ (р╕Ир╕░р╕Чр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Фр╕┤р╕б)",
    "res_finish_msg": "тЬЕ **Restock р╕кр╕│р╣Ар╕гр╣Зр╕И!**\nр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╕▓р╕Зр╕зр╕▒р╕ер╣Бр╕ер╕░р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з",
    "res_err_invalid_link": "тЭМ р╕ер╕┤р╣Йр╕Зр╕Др╣Мр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З р╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Вр╕нр╕Зр╕Ър╕нр╕Чр╕Щр╕╡р╣Й",
    "res_err_not_found": "тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕╣р╣Йр╕Щр╕╡р╣Йр╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е",

    "gam_select_topup": "р╣Ар╕Хр╕┤р╕б Point (Top-up)",
    "gam_opt_tm": "TrueMoney Wallet",
    "gam_opt_pp": "PromptPay",
    "gam_btn_check_point": "р╣Ар╕Кр╣Зр╕Др╣Бр╕Хр╣Йр╕б",
    "gam_btn_check_stock": "р╣Ар╕Кр╣Зр╕Др╕кр╕┤р╕Щр╕Др╣Йр╕▓/р╕Ьр╕╣р╣Йр╕Кр╕Щр╕░",
    "gam_stock_title": "ЁЯУж р╕кр╕Цр╕▓р╕Щр╕░р╕Вр╕нр╕Зр╕гр╕▓р╕Зр╕зр╕▒р╕е",
    "gam_stock_available": "тЬЕ р╕зр╣Ир╕▓р╕З",
    "gam_stock_claimed": "ЁЯПЖ р╕Хр╕Бр╣Ар╕Ыр╣Зр╕Щр╕Вр╕нр╕З {user}",
    "gam_my_point_title": "ЁЯТ░ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Point р╕Чр╕╡р╣Ир╕бр╕╡",
    "gam_my_point_desc": "р╕Др╕╕р╕Ур╕бр╕╡р╣Бр╕Хр╣Йр╕бр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н: **{points}** Point",
    "top_tm_modal_title": "р╣Ар╕Хр╕┤р╕бр╣Ар╕Зр╕┤р╕Щ TrueMoney (р╕Лр╕нр╕З)",
    "top_tm_lbl_link": "р╕ер╕┤р╣Йр╕Зр╕Др╣Мр╕Лр╕нр╕Зр╕нр╕▒р╣Ир╕Зр╣Ар╕Ыр╕▓",
    "top_tm_sent": "тЬЕ р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╣Йр╕з р╕гр╕нр╣Бр╕нр╕Фр╕бр╕┤р╕Щр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ...",
    "top_tm_log": "ЁЯзз **р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Ар╕Хр╕┤р╕бр╣Ар╕Зр╕┤р╕Щ (р╕Лр╕нр╕З)**\nЁЯСд р╕Ьр╕╣р╣Йр╣Ар╕Хр╕┤р╕б: {user}\nЁЯФЧ р╕ер╕┤р╣Йр╕Зр╕Др╣М: {link}",
    "tm_auto_success": "тЬЕ **р╣Ар╕Хр╕┤р╕бр╣Ар╕Зр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И!**\nЁЯТ░ р╕Др╕╕р╕Ур╣Др╕Фр╣Йр╕гр╕▒р╕Ъ: {amount} р╕Ър╕▓р╕Ч\nЁЯТО р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╣Бр╕Хр╣Йр╕б: {points} Point",
    "tm_err_generic": "тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕Хр╕┤р╕бр╣Ар╕Зр╕┤р╕Щ: {error}",
    "tm_log_auto_title": "ЁЯдЦ р╣Ар╕Хр╕┤р╕бр╣Ар╕Зр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И (Auto)",
    "top_pp_modal_title": "р╣Ар╕Хр╕┤р╕бр╣Ар╕Зр╕┤р╕Щ PromptPay",
    "top_pp_lbl_amount": "р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Ар╕Хр╕┤р╕б",
    "top_pp_msg_api": "ЁЯТ│ **р╕кр╣Бр╕Бр╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ**\nр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ: `{amount:.2f}` р╕Ър╕▓р╕Ч\nRef: `{ref}`",
    "top_pp_msg_manual": "ЁЯПж **р╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щр╕Ьр╣Ир╕▓р╕Щ PromptPay**\nр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ: {amount} р╕Ър╕▓р╕Ч\nр╣Вр╕Ыр╕гр╕Фр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щр╣Бр╕ер╕░р╕Бр╕Фр╕Ыр╕╕р╣Ир╕бр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ы",
    "top_pp_btn_confirm": "р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╣Вр╕нр╕Щ (р╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ы)",
    "top_slip_room_created": "тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╕лр╣Йр╕нр╕Зр╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ыр╣Бр╕ер╣Йр╕з: {channel}",
    "top_slip_wait": "{user} ЁЯз╛ р╣Вр╕Ыр╕гр╕Фр╕кр╣Ир╕Зр╕гр╕╣р╕Ыр╕кр╕ер╕┤р╕Ыр╣Гр╕Щр╕Кр╣Ир╕нр╕Зр╕Щр╕╡р╣Й\n-# р╕Ир╕░р╕бр╕╡р╣Бр╕нр╕Фр╕бр╕┤р╕Щр╕бр╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╣Ар╕Хр╕┤р╕бр╕Юр╕нр╕вр╕Чр╣Мр╣Гр╕лр╣Й",
    "top_slip_received": "ЁЯУе р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕кр╕ер╕┤р╕Ыр╣Бр╕ер╣Йр╕з р╕Бр╕│р╕ер╕▒р╕Зр╣Ар╕гр╕╡р╕вр╕Бр╣Бр╕нр╕Фр╕бр╕┤р╕Щ...",
    "top_slip_log_embed": "ЁЯз╛ **р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Вр╕нр╕Щ (р╕кр╕ер╕┤р╕Ы)**\nЁЯСд р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й: {user}\nЁЯТ░ р╕вр╕нр╕Фр╕Чр╕╡р╣Ир╣Бр╕Ир╣Йр╕З: {amount} р╕Ър╕▓р╕Ч",
    "top_slip_embed_title": "ЁЯз╛ р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Вр╕нр╕Щр╣Гр╕лр╕бр╣И",
    "top_btn_approve": "р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ / р╣Гр╕лр╣Й Point",
    "top_btn_deny": "р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤",
    "top_modal_approve_title": "р╕гр╕░р╕Ър╕╕р╕Ир╕│р╕Щр╕зр╕Щ Point",
    "top_lbl_amount": "р╕Ир╕│р╕Щр╕зр╕Щ Point",
    "top_modal_deny_title": "р╕гр╕░р╕Ър╕╕р╣Ар╕лр╕Хр╕╕р╕Ьр╕ер╕Бр╕▓р╕гр╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤",
    "top_lbl_reason": "р╣Ар╕лр╕Хр╕╕р╕Ьр╕е",
    "log_approve_msg": "{user} тЬЕ **р╕кр╕ер╕┤р╕Ыр╕Вр╕нр╕Зр╕Др╕╕р╕Ур╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤**",
    "log_approve_desc": "р╕Др╕╕р╕Ур╣Др╕Фр╣Йр╕гр╕▒р╕Ъ **{amount}** Point р╕Вр╕нр╣Гр╕лр╣Йр╕кр╕Щр╕╕р╕Бр╕Бр╕▒р╕Ър╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕б!",
    "log_deny_msg": "{user} тЭМ **р╕кр╕ер╕┤р╕Ыр╕Вр╕нр╕Зр╕Др╕╕р╕Ур╣Др╕бр╣Ир╕Ьр╣Ир╕▓р╕Щр╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤**",
    "log_deny_title": "ЁЯЪл р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Бр╕▓р╕гр╕Ыр╕Пр╕┤р╣Ар╕кр╕Шр╕вр╕нр╕Ф",
    "log_deny_reason": "ЁЯУЭ **р╣Ар╕лр╕Хр╕╕р╕Ьр╕е:** {reason}\n-# р╣Вр╕Ыр╕гр╕Фр╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╣Бр╕нр╕Фр╕бр╕┤р╕Щр╕лр╕▓р╕Бр╕бр╕╡р╕Вр╣Йр╕нр╕кр╕Зр╕кр╕▒р╕в",
    "log_reward_title": "ЁЯОЙ р╕вр╕┤р╕Щр╕Фр╕╡р╕Фр╣Йр╕зр╕в! р╕Ьр╕╣р╣Йр╣Вр╕Кр╕Др╕Фр╕╡р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕гр╕▓р╕Зр╕зр╕▒р╕е",
    "log_reward_desc": "ЁЯСд **р╕Ьр╕╣р╣Йр╣Др╕Фр╣Йр╕гр╕▒р╕Ъ:** {user}\nЁЯОБ **р╕гр╕▓р╕Зр╕зр╕▒р╕е:** {prize}\nЁЯО▓ **р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕кр╕╕р╣Ир╕б:** {attempts} р╕Др╕гр╕▒р╣Йр╕З\nЁЯТ╕ **р╕гр╕зр╕бр╣Гр╕Кр╣Йр╣Др╕Ы:** {total_cost} Point",
    "play_anim_title": "ЁЯО░ р╕Бр╕│р╕ер╕▒р╕Зр╕кр╕╕р╣Ир╕б...",
    "play_result_title": "ЁЯОЙ р╕Ьр╕ер╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕б",
    "play_result_desc": "р╕Др╕╕р╕Ур╣Др╕Фр╣Йр╕гр╕▒р╕Ъ: **{prize_name}**",
    # config.py (р╣Гр╕Щр╕Хр╕▒р╕зр╣Бр╕Ыр╕г MESSAGES)

    # ... (р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕нр╕╖р╣Ир╕Щр╣Ж) ...

    # --- Ticket Forum ---
    "tf_setup_success": "тЬЕ р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Forum {forum} р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в",
    "tf_guide_msg": "ЁЯСЗ р╕Бр╕Фр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Хр╕гр╕Зр╕Щр╕╡р╣Й",
    "tf_btn_buy": "ЁЯЫТ р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н (Tickets)",
    "tf_btn_buying": "тП│ р╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕Лр╕╖р╣Йр╕н",
    "tf_btn_report": "ЁЯЪй р╕гр╕▓р╕вр╕Зр╕▓р╕Щ",
    "tf_err_own_post": "тЭМ р╕Др╕╕р╕Ур╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕Зр╣Др╕Фр╣Й",
    "tf_err_own_report": "тЭМ р╕Др╕╕р╕Ур╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Вр╕Юр╕кр╕Хр╣Мр╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕Зр╣Др╕Фр╣Й",
    "tf_only_seller": "ЁЯЪл р╣Ар╕Йр╕Юр╕▓р╕░ **р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в** р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щр╕Чр╕╡р╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Бр╕Фр╕Ыр╕╕р╣Ир╕бр╕Щр╕╡р╣Йр╣Др╕Фр╣Й",
    "tf_room_created": "ЁЯФР **р╕Кр╣Ир╕нр╕Зр╕Лр╕╖р╣Йр╕нр╕Вр╕▓р╕вр╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з**\nЁЯСд р╕Ьр╕╣р╣Йр╕Лр╕╖р╣Йр╕н: {buyer}\nЁЯСд р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в: {seller}\n-# р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Ир╕гр╕Ир╕▓р╣Бр╕ер╕░р╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щр╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ",
    "tf_wait_admin": "ЁЯФФ р╕Бр╕│р╕ер╕▒р╕Зр╣Ар╕гр╕╡р╕вр╕Бр╣Бр╕нр╕Фр╕бр╕┤р╕Щр╕бр╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ...",
    "tf_admin_panel_msg": "ЁЯЫбя╕П р╕Ыр╕╕р╣Ир╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕нр╕Фр╕бр╕┤р╕Щ:",
    "tf_btn_finish": "р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ(р╕Ыр╕┤р╕Фр╕Кр╣Ир╕нр╕З)",
    "tf_btn_cancel": "р╕вр╕Бр╣Ар╕ер╕┤р╕Б",
    "tf_btn_admin_close": "р╕Ыр╕┤р╕Фр╕Кр╣Ир╕нр╕Зр╣Бр╕ер╕░р╕ер╕Ър╣Вр╕Юр╕кр╕Хр╣М",
    "tf_modal_report_title": "р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Вр╕Юр╕кр╕Хр╣М",
    "tf_lbl_reason": "р╣Ар╕лр╕Хр╕╕р╕Ьр╕е",
    "tf_msg_report_success": "тЬЕ р╕кр╣Ир╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в",
    "tf_modal_cancel_title": "р╣Ар╕лр╕Хр╕╕р╕Ьр╕ер╕Бр╕▓р╕гр╕вр╕Бр╣Ар╕ер╕┤р╕Б",
    "tf_log_report_title": "ЁЯЪй р╕бр╕╡р╕Бр╕▓р╕гр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Вр╕Юр╕кр╕Хр╣М",
    "tf_log_cancel_title": "тЭМ ЁЭЧзЁЭЧ┐ЁЭЧоЁЭЧ╗ЁЭШАЁЭЧоЁЭЧ░ЁЭШБЁЭЧ╢ЁЭЧ╝ЁЭЧ╗ ЁЭЧЦЁЭЧоЁЭЧ╗ЁЭЧ░ЁЭЧ▓ЁЭЧ╣ЁЭЧ╣ЁЭЧ▓ЁЭЧ▒",
    "tf_log_cancel_desc": "р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Цр╕╣р╕Бр╕вр╕Бр╣Ар╕ер╕┤р╕Б (Ticket ID-{count})",
    "tf_log_success_title": "тЬЕ ЁЭЧзЁЭЧ┐ЁЭЧоЁЭЧ╗ЁЭШАЁЭЧоЁЭЧ░ЁЭШБЁЭЧ╢ЁЭЧ╝ЁЭЧ╗ ЁЭЧЦЁЭЧ╝ЁЭЧ║ЁЭЧ╜ЁЭЧ╣ЁЭЧ▓ЁЭШБЁЭЧ▓ЁЭЧ▒",
    "tf_log_success_desc": "р╕Шр╕╕р╕гр╕Бр╕гр╕гр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ (Ticket ID-{count})",

    # ... (р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕нр╕╖р╣Ир╕Щр╣Ж) ...
}

# =========================================
# DATA MANAGEMENT
# =========================================
def load_data():
    if not os.path.exists(DATA_FILE):
        return {
            "admins": [], "supports": [], "auction_count": 0, "ticket_count": 0,
            "ticket_configs": {}, "lockdown_time": 0, 
            "points": {}, 
            "claimed_prizes": {}, # {msg_id: [index_list]}
            "gamble_configs": {}, # {msg_id: config_dict}
            "gamble_stats": {}    # {msg_id: {user_id: count}}
        }
    with open(DATA_FILE, "r", encoding="utf-8") as f:
        return json.load(f)

def save_data(data):
    with open(DATA_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, indent=4, ensure_ascii=False)

def is_admin_or_has_permission(interaction):
    data = load_data()
    user_id = interaction.user.id
    user_roles = [r.id for r in interaction.user.roles]
    if user_id in data["admins"] or any(r in data["admins"] for r in user_roles): return True
    if interaction.user.guild_permissions.administrator: return True
    return False

def is_support_or_admin(interaction):
    if is_admin_or_has_permission(interaction): return True
    data = load_data()
    user_id = interaction.user.id
    user_roles = [r.id for r in interaction.user.roles]
    if user_id in data["supports"] or any(r in data["supports"] for r in user_roles): return True
    return False

async def get_files_from_urls(urls):
    import aiohttp
    import io
    import discord
    files = []
    async with aiohttp.ClientSession() as session:
        for i, url in enumerate(urls):
            if not url: continue
            try:
                async with session.get(url) as resp:
                    if resp.status == 200:
                        data = await resp.read()
                        files.append(discord.File(io.BytesIO(data), filename=f"image_{i}.png"))
            except: pass
    return files
